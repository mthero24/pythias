<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Pythias Technologies File Writer</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="icon" href="/logo-dark-50.png">
    <script src="https://cdn.jsdelivr.net/npm/axios@1.7.9/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  </head>
  <body style="background: #faf9f9;">
    <%- include('partials/menu.ejs') %>
    <div style="width: 100%;">
      <div class="row">
        <div class="col-4"></div>
        <div class="col-4">
          <img src="/logo-dark-400.png" width="100%" height="auto" style="width: 100%; height: auto;"/>
          
        </div>
        <div class="col-4"></div>
        <div class="col-1"></div>
        <div class="col-10">
          
        </div>
        <div class="col-1"></div>
      </div>
      <p id="text" style="text-align:center;"><%=lastFileWritten%></p>
    </div>
    
    <script type="text/javascript">
      let i = 0
      let file
      let getUpdate = async ()=>{
        let res = await axios.get("/update").catch(e=>{console.log(e.response.data)})
        //console.log(res?.data)
        return res.data.lastFileWritten
      }
      setInterval(async ()=>{
        //console.log("setting text")
        let newFile = await getUpdate()
        if(newFile !== file) {
          file = newFile
          i = 0
        }
        let seconds
        let minutes
        let hours
        let days
        seconds = i % 60
        minutes = parseInt(i / 60)
        if(minutes > 60){
          hours = parseInt(minutes / 60)
          minutes = minutes % 60
        }
        document.getElementById("text").innerHTML = `${file} -- written ${hours > 0? `${hours} hours and`: ""} ${minutes > 0? `${minutes} minutes and`: ""} ${seconds} seconds ago`
        i++
      }, 1000)
    </script>
  </body>
</html>
