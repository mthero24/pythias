<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>internal server</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/axios@1.7.9/dist/axios.min.js"></script>
  </head>
  <body style="background: #faf9f9;">
    <%- include('partials/menu.ejs') %>
    <div class="row">
      <div class="col-4"></div>
      <div class="col-4">
        <img src="/logo-dark-400.png" width="100%" height="auto" style="width: 100%; height: auto;"/>
        
      </div>
      <div class="col-4"></div>
      <div class="col-1"></div>
      <div class="col-10">
        <div class="form-floating mb-3">
            <input class="form-control" id="user-name" placeholder="User Name" onkeydown="isEnter(event)">
            <label for="floatingInput">User Name <span style="color: rgb(187, 30, 30); display: none" id="user-name-required">Required!</span></label>
        </div>
        <div class="form-floating">
            <input type="password" class="form-control" id="password" placeholder="Password" onkeydown="isEnter(event)">
            <label for="floatingPassword">Password <span style="color: rgb(187, 30, 30); display: none" id="password-required">Required!</span></label>
        </div>
        <div class="d-grid gap-2" style="margin-top: 2%;">
            <button class="btn" style="background-color: #b4d6b4;" type="button" onclick="login()"><%=register? "Register Account": "Login"%></button>
        </div>
      </div>
      <div class="col-1"></div>
    </div>
    <script type="text/javascript">
        let register = Boolean('<%=register%>')
        const login = async ()=>{
            console.log(document.getElementById("user-name").value, document.getElementById("password").value)
            if(document.getElementById("user-name").value == ""){
                document.getElementById("user-name-required").style.display = "block"
            }else{
                document.getElementById("user-name-required").style.display = "hidden"
            }
            if(document.getElementById("password").value == ""){
                document.getElementById("password-required").style.display = "block"
            }else{
                document.getElementById("password-required").style.display = "hidden"
            }
            if(document.getElementById("user-name").value !== "" && document.getElementById("password").value !== ""){
                let res = await axios.post(!register? "/register": "/login", {userName: document.getElementById("user-name").value, password: document.getElementById("password").value})
                console.log(res.data)
                if(res.data.error){
                    alert(res.data.msg)
                }
                else{
                    console.log(res.data.key)
                    location.href = `/settings?key=${res.data.key}`
                }
            }
        }
        const isEnter = (event)=>{
            if(event.key == "Enter" || event.key == "ENTER" || event.key == 13) login()
        }
    </script>
  </body>
</html>
