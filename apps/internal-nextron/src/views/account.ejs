<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>internal server</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/axios@1.7.9/dist/axios.min.js"></script>
  </head>
  <body style="background: #faf9f9;">
    <%- include('partials/menu.ejs') %>
    <div class="row">
      <div class="col-4"></div>
      <div class="col-4">
        <img src="/logo-dark-400.png" width="100%" height="auto" style="width: 100%; height: auto;"/>
        
      </div>
      <div class="col-4"></div>
      <div class="col-1"></div>
      <div class="col-10">
        <div class="input-group mb-3">
          <input type="text" class="form-control" placeholder="Api Key" aria-label="api key" aria-describedby="basic-addon2" disabled value="<%=apiKey.key? apiKey.key: ""%>" id="api-key">
          <span class="input-group-text" id="basic-addon2" onclick="getKey()" style="cursor: pointer; background-color: #b4d6b4;">Generate New Key</span>
        </div>
      </div>
      <div class="col-1"></div>
    </div>
    <script type="text/javascript">
      const key = '<%=key%>'
      const getKey = async ()=>{
        
        document.getElementById("api-key").disabled = false
        let res = await axios.post("/generate-api-key", {key})
        if(res.data.error) {
          console.log(res.data.apiKey.key)
          alert(res.data.msg)
          if(res.data.msg == "invalid key") location.href = "/login"
        }
        else {
          console.log(res.data.apiKey.key)
          document.getElementById("api-key").disabled = false
          document.getElementById("api-key").value = res.data.apiKey.key
          document.getElementById("api-key").disabled = true
        }
      }
      //window.electronAPI.printDocument({file: "dl.pdf", printer: "HP OfficeJet Pro 8020 series [63D443]"});
    </script>
  </body>
</html>
